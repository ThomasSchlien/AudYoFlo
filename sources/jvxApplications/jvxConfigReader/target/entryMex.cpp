#if _MATLAB_MEXVERSION < 500
#if (_MSC_VER >= 1600)
#include <yvals.h>
#define __STDC_UTF_16__
#endif
#endif
#include <mex.h>

/*
#pragma comment ( lib, "libmx")
#pragma comment ( lib, "libmex")
#pragma comment ( lib, "libeng")
#pragma comment ( lib, "libmat")*/
//#pragma comment ( lib, "libmatlb") 

//

#include "mexConfigReader.h"
#include <jvx.h>
#include <stdio.h>
#include <string>
#include <vector>

/**
 * Function to create a C string in MEX format.
 *///=========================================================0
static std::string
createCStringMex(const mxArray* phs) 
{
	size_t bufLen = mxGetM(phs)*mxGetN(phs)*sizeof(char)+1;
	char* buf = new char[bufLen];
	mxGetString(phs, buf, bufLen);
	std::string str = buf;
	delete[](buf);
	return(str);
}


/**
 * C-style entry from MATLAB to MEX component.
 * All command arguments are passed in the optional arguments for
 * this mex function.
 *///=============================================================
void mexFunction( int nlhs, mxArray *plhs[],
 				  int nrhs, const mxArray *prhs[] )
{
	mexConfigReader theReader;

	theReader.init();
	if((nrhs == 1)&&(nlhs == 1))
	{
		std::string fName = "";

		// Step I: Extract command ID from input argument
		if(mxIsChar(prhs[0]))
		{
			fName = createCStringMex(prhs[0]);
		}

		theReader.parseFile(fName, plhs[0]);
	}
	else
	{
		mexPrintf("mexConfigReaderMatlab: Tool to read out config files generated by RTproc to \n");
		mexPrintf("return a strcut with the content.\n");
		mexPrintf("Syntax: [out] = mexConfigReaderMatlab(filename);\n");
	}

	theReader.terminate();
}

